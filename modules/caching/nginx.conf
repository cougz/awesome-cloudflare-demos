# Cloudflare Caching Test Endpoints
# This configuration provides test endpoints for Cloudflare caching behavior

location /test-no-header/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    # No Cache-Control header sent by origin
}

location /test-public/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public, max-age=600";
}

location /test-private/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "private";
}

location /test-set-cookie/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Set-Cookie "test=value; Path=/";
}

location /test-revalidate/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public, s-maxage=1";
}

location /test-no-store/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "no-store";
}

location /test-s-maxage/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public, s-maxage=30";
}

location /test-cookie-auth/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    # Check for auth_token cookie
    if ($cookie_auth_token != "my_secret_value") {
        return 403;
    }
    add_header Cache-Control "public";
}

location /test-dynamic-file {
    alias /usr/share/nginx/html/test-files/modules/caching/dynamic-page.html;
    default_type text/html;
    # No Cache-Control header - HTML is not in CF's default cacheable list
}

location /test-resize/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public";
}

# 404 test endpoint (file doesn't exist)
location /test-404.jpg {
    return 404;
}

# Task 13: Cache-Tags (Selective Purging)
location /test-cache-tags/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public, max-age=3600";
    add_header Cache-Tag "product-123, category-shoes";
}

# Task 14: Vary Header (Cache Key Variations)
location /test-vary/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public, max-age=3600";
    add_header Vary "Accept-Encoding";
    gzip on;
    gzip_types text/plain;
}

# Task 15: Browser vs Edge TTL
location /test-browser-edge-ttl/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public, max-age=300, s-maxage=3600";
}

# Task 16: Stale-While-Revalidate
location /test-swr/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public, max-age=10, stale-while-revalidate=60";
}

# Task 17: Query String Handling
location /test-query/ {
    alias /usr/share/nginx/html/test-files/modules/caching/;
    add_header Cache-Control "public, max-age=3600";
}
